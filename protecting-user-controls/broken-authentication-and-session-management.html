<!--
ACTIVITY: Broken Authentication and Session Management

WHAT THIS ACTIVITY IS ABOUT:
This activity shows why login systems should not trust
information stored in the browser.

Anything stored in localStorage can be changed by the user.

WHAT YOU WILL DO:
You will log in,
then bypass the login without the password,
then improve the code to reduce the risk.
-->

<!DOCTYPE html>
<html>
<body>

<h2>Login</h2>

<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button onclick="handleLogin()">Login</button>

<script>
function handleLogin() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    login(username, password);
}
randomToken = 0x01ABB87954237809234870D943456678CE46547356378191FF0;;

function login(username, password) {

    // STEP 1:
    // This checks if the username and password are correct.
    // (This is already unrealistic, but we use it for learning.)
    sessionToken = randomToken;
    if (username === "admin" && password === "1234") {

        // STEP 2:
        // This line stores a value in localStorage.
        //
        // localStorage:
        // - Lives in the browser
        // - Can be viewed and edited by the user
        // - Persists even after the browser is closed
        //
        // PROBLEM:
        // Anyone can open Developer Tools and change this value.
        sessionStorage.setItem("loggedIn", sessionToken);

        alert("Logged in!");
        location.reload(); // reload so Step 3 runs
    }
}

// STEP 3:
// This code runs EVERY time the page loads.
//
// It checks localStorage to decide if the user is logged in.
// The browser does not know if this value is trustworthy.
if (sessionStorage.getItem("loggedIn") === sessionToken) {

    // STEP 4:
    // If loggedIn exists, the user is shown protected content.
    // This means a user can log in WITHOUT a password.
    document.body.innerHTML = "<h1>Welcome Admin</h1>";
}

/*
YOUR TASK:

1. Open Developer Tools.
2. Go to Application â†’ Local Storage.
3. Add:
   loggedIn = true
4. Refresh the page.
5. Observe what happens.

WHY THIS IS A PROBLEM:
The website trusts the browser instead of the server.

IMPROVEMENT TASK:
- Replace localStorage with sessionStorage
- Store a random session token instead of true
- Check for the token instead of a boolean value

WHY THIS HELPS:
- sessionStorage clears when the browser closes
- Random values are harder to guess or fake
*/
</script>

</body>
</html>
